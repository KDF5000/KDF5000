<html><head><meta name="generator" content="Hexo 3.9.0"><title>使用svn和markdown管理项目文档</title><meta name="keywords" content="KDF5000, OpenHex"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">使用svn和markdown管理项目文档</h2><p>文档管理，是每个项目非常重要又非常让人头疼的问题，每份文档可能会有不同的版本，而且可能还有有不同的人来共同编辑。除此还要考虑怎么才能方便的分享给项目组其他成员查看。也正是这些原因很多笔记记录软件推出了协同办公的功能，比如印象笔记，为知笔记等。但是把东西放在他们那里似乎不是很安全呵，毕竟是项目文档，都是比较私密的东西。也有一些团队协作平台提供了这个功能，不过他们都比较简单，只是上传下载文件。这两种方式似乎都不是很令人满意。</p><p>最近做项目，内部使用<code>svn</code>管理代码。就想是不是也可以使用svn来管理文档（当然有的公司确实是使用svn管理文档的），等等，这只是解决了文档的多人协作和版本控制的功能。那么怎么才能实现大家更方便的查看文档呢？借鉴现在比较流行的<code>Jekyll</code>，<code>hexo</code>搭建博客的思路，使用<code>markdown</code>写博客，然后生成<code>html</code>。因此借鉴这个思路，使用<code>svn</code>管理项目文档，项目文档尽可能使用<code>markdown</code>编写，然后写一个脚本定时解析<code>md</code>文件生成<code>html</code>，搭建一个服务器，将生成的<code>html</code>部署到服务器，这样同一个局域网的组员就可以访问这些文档了。</p><p>####搭建svn<br><code>svn</code> 分为服务端和客户端，搭建详细教程参考<a href="http://www.jb51.net/article/29005.htm" target="_blank" rel="noopener"><code>windows下svn服务器的搭建</code></a></p><p>####解析<code>md</code>文件生成<code>html</code><br>markdown本来就是一种轻量级的标记语言，有很多开源的解析markdown文件的项目。本文使用一个开源的<code>PHP</code>的开源项目<a href="https://github.com/erusev/parsedown" target="_blank" rel="noopener">ParseDown</a>，用来解析markdown生成html文件，在此项目的基础上，封装了一个类，实现解析指定目录下所有markdown文件，生成html文件（包括子目录下的markdown文档，按照原来的目录存放）。</p><p>下面是指定目录下所有的<code>md</code>文件生成<code>html</code>文件的源码：</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line">* 解析指定目录下所有的md文件生成html文件</span><br><span class="line">**/</span><br><span class="line">require_once &apos;Parsedown.php&apos;;</span><br><span class="line">class Parse2Html&#123;</span><br><span class="line">	private $files; //指定目录下的所有文件</span><br><span class="line"></span><br><span class="line">	function __construct($dir,$extension=&apos;md&apos;)&#123;</span><br><span class="line">		if($dir==NULL ||!is_dir($dir))&#123;</span><br><span class="line">			echo &apos;请指定一个合法目录&apos;;</span><br><span class="line">			exit;</span><br><span class="line">		&#125;</span><br><span class="line">		$this-&gt;files = self::getAllFiles($dir);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 解析目录下面的所有md文件输出到html文件</span><br><span class="line">	 */</span><br><span class="line">	public function parse2Html()&#123;</span><br><span class="line">		foreach ($this-&gt;files as $file ) &#123;</span><br><span class="line">			$down_text = file_get_contents($file);</span><br><span class="line">			$file_name = pathinfo($file,PATHINFO_FILENAME);</span><br><span class="line">			$title = iconv(&apos;gb2312&apos;,&apos;utf-8&apos;,$file_name);</span><br><span class="line">			$html_content = $this-&gt;html($down_text,$title);</span><br><span class="line"></span><br><span class="line">			file_put_contents(dirname($file).DIRECTORY_SEPARATOR.$file_name.&apos;.html&apos;,$html_content);</span><br><span class="line">			echo $file_name.&apos;export successfully!&apos;.PHP_EOL;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 将markdown内容转换为html</span><br><span class="line">	 * @param $down_text</span><br><span class="line">	 * @param $title</span><br><span class="line">	 * @return string</span><br><span class="line">	 */</span><br><span class="line">	private function html($down_text, $title)&#123;</span><br><span class="line">		$parsedown = Parsedown::instance();</span><br><span class="line">		$parsedown-&gt;setBreaksEnabled(true);</span><br><span class="line">		$html_text = $parsedown-&gt;text($down_text);</span><br><span class="line">		$html_content = &lt;&lt;&lt;CONTAINER</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&apos;Content-Type&apos; content=&apos;text/html; charset=utf-8&apos; /&gt;</span><br><span class="line">	&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">	&lt;title&gt;$title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	$html_text</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">CONTAINER;</span><br><span class="line">		return $html_content;</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 获取指定目录下的所有文件，返回一个数组，数组元素为文件的实际路径</span><br><span class="line">	 * @param $dir</span><br><span class="line">	 * @return array</span><br><span class="line">	 */</span><br><span class="line">	private static function getAllFiles($dir,$extension=&apos;md&apos;)&#123;</span><br><span class="line">		$files = array();</span><br><span class="line">		if(is_file($dir))&#123;</span><br><span class="line">			if(pathinfo($dir,PATHINFO_EXTENSION) == $extension)&#123;</span><br><span class="line">				array_push($files,$dir);</span><br><span class="line">			&#125;</span><br><span class="line">			return $files;</span><br><span class="line">		&#125;</span><br><span class="line">		$folder = new DirectoryIterator($dir);</span><br><span class="line">		foreach($folder as $file)&#123;</span><br><span class="line">			if($file-&gt;isFile())&#123;</span><br><span class="line">				if(pathinfo($file,PATHINFO_EXTENSION) == $extension)&#123;</span><br><span class="line">					array_push($files,$file-&gt;getRealPath());</span><br><span class="line">				&#125;</span><br><span class="line">				continue ;</span><br><span class="line">			&#125;</span><br><span class="line">			if(!$file-&gt;isDot())&#123;</span><br><span class="line">				$sub_files = self::getAllFiles($file-&gt;getRealPath(),$extension);</span><br><span class="line">				$files = array_merge($files,$sub_files);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return $files;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p> 调用Parse2Html类的方法如下(index.php):<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once &apos;Parse2Html.php&apos;;</span><br><span class="line">$dir = dirname(__FILE__).DIRECTORY_SEPARATOR.&apos;Doc&apos;;</span><br><span class="line">$parse2Html = new Parse2Html($dir);</span><br><span class="line">$parse2Html-&gt;parse2Html();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p></p><p>####<code>svn</code>建立文档仓库<br>新建一个<code>svn</code>仓库，所有编写的<code>markdown</code>文档都放进去，然后<strong>将在上一步的<code>index.php</code>里指定该仓库的目录为解析的目录</strong>。然后写一个<code>bat</code>文件，调用<code>index.php</code>文件生成<code>html</code>文件，内容如下:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php F:\Boss\Doc\index.php  ；假设已经将php可执行程序添加到环境变量</span><br></pre></td></tr></table></figure><p></p><p>此时运行<code>bat</code>文件就可以解析<code>svn</code>目录下的所有<code>md</code>文件生成<code>html</code>文档，也可以将该<code>bat</code>文件添加到系统任务里，设定每天固定时间执行。<br>执行结果如下:<br><img src="/images/archive/img_parse2htmll2.png" alt><br>其中<code>产品概述.html</code>是由<code>产品概述.md</code>文档生成的</p><p>####部署到<code>apache</code>服务器<br>这里使用的是<code>Apache</code>服务器，当然也可以是其他服务器，比如<code>IIS</code>，只要可以解析html文件就可以。将网站的目录设置为<code>svn</code>文档仓库的根目录，在根目录下编写一个<code>index.php</code>文件，用于罗列该目录下所有想要显示的文件。内容如下<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=gb2312&quot;);</span><br><span class="line">/**</span><br><span class="line"> * 获取指定目录下的所有文件，返回一个数组，数组元素为文件的实际路径</span><br><span class="line"> * @param $dir</span><br><span class="line"> * @return array</span><br><span class="line"> */</span><br><span class="line">function getAllFiles($dir,$extension)&#123;</span><br><span class="line">    $files = array();</span><br><span class="line">    if(is_file($dir))&#123;</span><br><span class="line">        if(in_array(pathinfo($dir,PATHINFO_EXTENSION),$extension))&#123;</span><br><span class="line">            array_push($files,$dir);</span><br><span class="line">        &#125;</span><br><span class="line">        return $files;</span><br><span class="line">    &#125;</span><br><span class="line">    $folder = new DirectoryIterator($dir);</span><br><span class="line">    foreach($folder as $file)&#123;</span><br><span class="line">        if($file-&gt;isFile())&#123;</span><br><span class="line">            if(in_array(pathinfo($file,PATHINFO_EXTENSION) ,$extension) )&#123;</span><br><span class="line">                array_push($files,$file-&gt;getRealPath());</span><br><span class="line">            &#125;</span><br><span class="line">            continue ;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!$file-&gt;isDot())&#123;</span><br><span class="line">            $sub_files = getAllFiles($file-&gt;getRealPath(),$extension);</span><br><span class="line">            $files = array_merge($files,$sub_files);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $files;</span><br><span class="line">&#125;</span><br><span class="line">$files = getAllFiles(dirname(__FILE__),array(&apos;html&apos;,&apos;doc&apos;,&apos;docx&apos;));</span><br><span class="line">$root_len = strlen(dirname(__FILE__));</span><br><span class="line">foreach ($files as $file) &#123;</span><br><span class="line">    $name = substr($file,$root_len+1,strlen($file)-strlen(pathinfo($file,PATHINFO_EXTENSION))-$root_len-1-1);</span><br><span class="line">    echo &quot;&lt;a href=&apos;&quot;.substr($file,strlen($_SERVER[&apos;DOCUMENT_ROOT&apos;])).&quot;&apos;/&gt;&quot;.$name.&quot;&lt;/a&gt;&lt;/br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p></p><p>此时访问大家好的网站，就可以看到如下结果:<br><img src="/images/archive/img_parse2html_1.png" alt><br><img src="/images/archive/img_parse2html_3.png" alt></p><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script></div><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>