<html><head><meta name="generator" content="Hexo 3.9.0"><title>Ubuntu 14.04 下安装使用Python rq模块</title><meta name="keywords" content="KDF5000, OpenHex"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">Ubuntu 14.04 下安装使用Python rq模块</h2><p><code>rq</code> 是<code>Python</code>的一个第三方模块，使用<code>rq</code>可以方便快速的实现<code>Python</code>的队列操作，实现多态电脑的分布式架构。其中 <em>R</em>是<code>Redis</code>的意思，<em>Q</em>是<code>Queue</code>的首字母，<code>rq</code>使用<code>Redis</code>和<code>Queue</code>实现分布式，分别实现了<code>Master</code>和<code>Worker</code>，通过<code>Redis</code>存储任务队列。</p><p>####Ubuntu14.04 安装rq<br>假设已经安装了<code>Python</code>和<code>pip</code>，本文通过<code></code>pip<code>来安装</code>rq`<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo pip install rq</span><br></pre></td></tr></table></figure><p></p><p>####安装<code>Redis</code><br><code>rq</code>模块使用<code>redis</code>保存队列信息，因此可以保证多台机器同时读取同一个队列，也就是多个<code></code>worker<code>同时工作，这也就达到了我们的目的。在</code>Ubuntu<code>下安装</code>Redis<code>比较简单，使用下面的命令即可，该命令除了安装</code>Redis<code>外，也会好心地帮你安装了</code>redis-cli`。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt-get install redis-server</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><p>安装完成后可以尝试启动一下<code>Reids</code>，检查是否安装成功。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-server</span><br></pre></td></tr></table></figure><p></p><p>上面的命令会使用默认的设置启动<code>Redis</code>服务，如果你看到下面漂亮启动界面说明安装成功了。</p><p>不过还没完额，使用下面命令看看我们可以看到什么<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -an | grep 6379</span><br></pre></td></tr></table></figure><p></p><p>结果：</p><p><img src="/images/archive/img_rq-redis-bind.png" alt></p><p>因为<code>Redis</code>默认使用的端口是6379，该命令可以查看6379端口监听的ip ，可以看到 <code>Redis</code>默认绑定的是<code>127.0.0.1</code>，可以在<code>/etc/redis/redis.conf</code>中看到该设置。</p><p><img src="/images/archive/img_rq-redis-redis-conf.png" alt></p><p><code>Redis</code>的默认配置绑定了<code>127.0.0.1</code>，注释掉<strong>bind 127.0.0.1</strong>即可。然后重启<code>Redis</code>。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/redis-server restart</span><br></pre></td></tr></table></figure><p></p><p>再次执行<code>netstat -an | grep 6379</code></p><p><img src="/images/archive/img_rq-redis-redis-netstat.png" alt></p><p>可以看到改变了 ，<code>Redis</code>已经可以接受同一个局域网内的<code>redis cli</code>连接了</p><p>####安装<code>rq-dashboard</code><br><code>rq-dashboard</code>是一个监控<code>rq</code>执行状况的<code>python</code>库，它可以显示当前有哪些<code>Queue</code>，每个<code>Queue</code>有多少<code>Job</code>，以及有多少<code>Worker</code>处于工作状态，还显示了失败的<code>Job</code>。可以使用<code>pip</code>方便的安装<code>Dashboard</code>.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo pip install rq-dashboard</span><br></pre></td></tr></table></figure><p></p><p>安装成功后，使用下面的命令启动<code>rq-dashboard</code><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rq-dashboard -u &quot;redus://192.168.0.107:6379&quot;</span><br></pre></td></tr></table></figure><p></p><p>其中<code>-u</code>参数是需要使用的<code>Redis</code>连接地址，启动成功后可以看到下面的信息</p><p><img src="/images/archive/img_rq-rqdashboard-start.png" alt></p><p>可以看出<code>Rq dashboard</code>的版本信息，以及运行的地址端口，也就是我们可以通过浏览器访问，默认的端口是<em>9181</em>，<code>IP</code>地址是启动<code>rq-dashboard</code>的机器<code>ip</code>，在同一局域网的电脑访问<code>http://192.168.0.107:9181</code>，其中<code>192.168.0.107</code>是启动<code>rq-dashboard</code>的电脑<code>ip</code>。</p><p><img src="/images/archive/img_rq-rqdashboard-web.png" alt></p><p><code>Rq-dashboard</code>是一个很有用的工具，可以图形化的监控<code>rq</code>的工作状态，但是美中不足，不能控制<code>worker</code>的工作，不过相信应该很快就会支持这些功能了。</p><p>####<code>rq</code>的使用<br><strong>参考<a href="http://python-rq.org/" target="_blank" rel="noopener">官方文档</a></strong></p><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script></div><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>