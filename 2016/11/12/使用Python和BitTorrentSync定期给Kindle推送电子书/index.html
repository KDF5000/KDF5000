<html><head><meta name="generator" content="Hexo 3.9.0"><title>使用Python和BitTorrentSync定期给Kindle推送电子书</title><meta name="keywords" content="KDF5000, OpenHex"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">使用Python和BitTorrentSync定期给Kindle推送电子书</h2><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kindle伴侣"><span class="toc-text">Kindle伴侣</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Resilio-Sync服务搭建"><span class="toc-text">Resilio Sync服务搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#监控进程"><span class="toc-text">监控进程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#后台启动"><span class="toc-text">后台启动</span></a></li></ol></li></ol><h4 id="Kindle伴侣"><a href="#Kindle伴侣" class="headerlink" title="Kindle伴侣"></a>Kindle伴侣</h4><p>最近发现一个很好用的Kindle电子书分享网站<a href="http://kindlefere.com/" target="_blank" rel="noopener">Kindle伴侣</a>，资源丰富，除了提供各种热门图书免费下载，还提供了很多关于Kindle的使用技巧，里面个人最喜欢的功能就是每周一书，使用BitTorrent每周自动同步热门电子书。使用的是著名的同步软件Resilio Sync， 最开始是在自己电脑上安装了软件同步，但是要一直开着，感觉好麻烦，有时候电脑还要关了，影响同步。刚好手里有个闲置的树莓派，于是就想着用它来同步，然后通过邮件将电子书发送到kindle，这样就可以每周都看到热门的电子书了。</p><a id="more"></a><p><img src="/images/archive/blog/image/kindle-0.png" alt="kindle-0"></p><h4 id="Resilio-Sync服务搭建"><a href="#Resilio-Sync服务搭建" class="headerlink" title="Resilio Sync服务搭建"></a>Resilio Sync服务搭建</h4><p>Linux下的安装方法可以参考官网：<a href="https://help.getsync.com/hc/en-us/articles/206178924" target="_blank" rel="noopener">https://help.getsync.com/hc/en-us/articles/206178924</a></p><p>下面的方法适合Raspbian，你可以按照官网的说明安装在任何一台可以上网的服务器上。</p><p><strong>Step1:</strong> 下载deb安装包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> wget https://download-cdn.getsync.com/2.0.128/PiWD/bittorrent-sync-pi-server_2.0.128_armhf.deb</span><br></pre></td></tr></table></figure><p><strong>Step2:</strong> 安装Sync包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo dpkg -i bittorrent-sync-pi-server_2.0.128_armhf.deb</span><br></pre></td></tr></table></figure><p><strong>Step3:</strong>访问Sync Web UI</p><p>通过浏览器访问<a href="http://yourrespbianip:8888" target="_blank" rel="noopener">http://yourrespbianip:8888</a> ,其中是你respian的ip地址或者你托管的服务器地址，你应该看到下面的界面</p><p> <img src="/images/archive/blog/image/kindle-1.png" alt="kindle-1"></p><p>然后到<a href="http://kindlefere.com/" target="_blank" rel="noopener">Kindle伴侣</a>随便点一个[每周一书]可以找到使用bittorrentSync同步的同步key，通过web页面添加到你自己的sync服务器即可。记得你选择的文件夹要有写入权限，我是直接给的777。</p><h4 id="监控进程"><a href="#监控进程" class="headerlink" title="监控进程"></a>监控进程</h4><p>这里使用Python作为监控程序监控上面Sync服务器的同步文件夹，一旦出现新的指定格式（如MOBI)的文件，则将会向指定的kindle邮箱发送新增加的电子书，邮箱的设置需要到amazon自己设置，想必用过kindle的应该不陌生。</p><p>代码可以从github下载：<a href="https://github.com/KDF5000/WeeklyBook" target="_blank" rel="noopener">https://github.com/KDF5000/WeeklyBook</a> , 然后修改<code>server.py</code>里面的kindle邮箱，以及授权的邮箱</p><blockquote><p>EXT_LIST = [‘mobi’] #想要发送的邮件格式<br>HOST_NAME = ‘smtp.cstnet.cn’ #授权邮箱的smtp服务器<br>HOST_PORT = 25 #smtp服务器端口<br>USER_NAME = <a href="mailto:&#39;kongdefei@ict.ac.cn" target="_blank" rel="noopener">&#39;kongdefei@ict.ac.cn</a>‘ #授权邮箱的用户名<br>USER_PASS = ‘<strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong>‘<br>KINDLE_MAILS = [<a href="mailto:&#39;kdf5000@kindle.cn" target="_blank" rel="noopener">&#39;kdf5000@kindle.cn</a>‘] #接收电子书的kindle邮箱，可以在亚马逊查看<br>FROM_NAME = <a href="mailto:&#39;kongdefei@ict.ac.cn" target="_blank" rel="noopener">&#39;kongdefei@ict.ac.cn</a>‘ #发送邮件的from名字，建议使用发送的邮箱地址</p></blockquote><h5 id="后台启动"><a href="#后台启动" class="headerlink" title="后台启动"></a>后台启动</h5><p>进入下载的文件夹，执行下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>nohup python server.py /home/ubuntu/kongdefei/SyncBook &gt; sync.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><p>其中<code>/home/ubuntu/kongdefei/SyncBook</code>是sync同步的文件夹，sync.out是server.py的输出日志，该程序将会在后台持续运行监控<code>/home/ubuntu/kongdefei/SyncBook</code>下面是否有新的电子书的出现。</p><p>至此，你就可以享受你心爱的kindle每周定时收到一本优秀的电子书了。<br>顺便晒一下树莓派[憨笑]<br><img src="/images/archive/blog/image/raspberry.jpeg" alt></p><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script></div><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>