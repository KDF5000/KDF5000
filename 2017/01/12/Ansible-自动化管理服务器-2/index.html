<html><head><meta name="generator" content="Hexo 3.9.0"><title>Ansible: 自动化管理服务器(2)</title><meta name="keywords" content="KDF5000, OpenHex"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link href="/css/main.css?v=3" rel="stylesheet" type="text/css"><script src="/js/util.js"></script><script>isMobile()?loadjscssfile("../css/mobile.css","css"):loadjscssfile("../css/desktop.css","css")</script><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"></head><body><h2 class="title">Ansible: 自动化管理服务器(2)</h2><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible-命令参数"><span class="toc-text">Ansible 命令参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible的常用模块"><span class="toc-text">Ansible的常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#shell模块"><span class="toc-text">shell模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#copy模块"><span class="toc-text">copy模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file模块"><span class="toc-text">file模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stat模块"><span class="toc-text">stat模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#管理软件模块"><span class="toc-text">管理软件模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#User模块"><span class="toc-text">User模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service模块"><span class="toc-text">service模块</span></a></li></ol></li></ol><h3 id="Ansible-命令参数"><a href="#Ansible-命令参数" class="headerlink" title="Ansible 命令参数"></a>Ansible 命令参数</h3><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-v</td><td>详细模式，如果命令执行成功，输出详细的结果</td></tr><tr><td>-i Path</td><td>指定host文件的路径，默认是/etc/ansible/hosts</td></tr><tr><td>-f Num</td><td>指定一个整数，默认是5，指定fork开启同步进程的个数</td></tr><tr><td>-m Name</td><td>指定使用的module名称，默认是command</td></tr><tr><td>-M path</td><td>指定module的目录。默认是/usr/share/ansible</td></tr><tr><td>-a Module_Args</td><td>指定module的参数</td></tr><tr><td>-k</td><td>提示输入ssh密码，而不是基于ssh的密钥认证</td></tr><tr><td>-sudo</td><td>指定使用sudo获得root权限</td></tr><tr><td>-K</td><td>提示输入sudo密码，与-sudo一起使用</td></tr><tr><td>-u Username</td><td>指定被控机器的执行用户</td></tr><tr><td>-C</td><td>测试此命令会改变什么内容，不会真正的去执行</td></tr></tbody></table><a id="more"></a><h3 id="Ansible的常用模块"><a href="#Ansible的常用模块" class="headerlink" title="Ansible的常用模块"></a>Ansible的常用模块</h3><h4 id="shell模块"><a href="#shell模块" class="headerlink" title="shell模块"></a>shell模块</h4><p>使用shell来执行命令，如</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ansible all -m shell -a "mkdir kongdefei"</span><br></pre></td></tr></table></figure><p>将会在每一个客户机上创建kongdefei的目录</p><h4 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h4><p>实现主控机向客户机复制文件，类似scp的功能，比如复制主控机器的/etc/hosts到客户端机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>ansible all -m copy -a "src=/etc/hosts dest=/tmp/hosts"</span><br></pre></td></tr></table></figure><h4 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h4><p>该模块称之为文件属性模块，可以创建，删除，修改文件属性等操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>创建文件</span><br><span class="line"><span class="meta">$</span>ansible all -m file -a "dest=/tmp/a.txt state=touch"</span><br><span class="line"><span class="meta">#</span>更改文件的用户和权限</span><br><span class="line"><span class="meta">$</span>ansible all -m file -a "dest=/tmp/a.txt mode=600 owener=www-data group=root"</span><br><span class="line"><span class="meta">#</span>创建目录</span><br><span class="line"><span class="meta">$</span>ansible all -m file -a "dest=/tmp/kongdefei owner=kongdefei group=root state=directory"</span><br><span class="line"><span class="meta">#</span>删除文件或者目录</span><br><span class="line"><span class="meta">$</span>ansible all -m file -a "dest=/tmp/kongdefei state=absent"</span><br></pre></td></tr></table></figure><p><strong>注：</strong>state的其他选项：link(链接)、hard(硬链接)</p><h4 id="stat模块"><a href="#stat模块" class="headerlink" title="stat模块"></a>stat模块</h4><p>获取指定文件的状态信息，比如atime, ctime, mtime, md5, uid, gid等</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ansible all -m stat -a "path=/home/kongdefei/tidb/tidb-latest-linux-amd64.tar.gz"</span><br></pre></td></tr></table></figure><p>返回</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">172.16.1.96 | SUCCESS =&gt; &#123;</span><br><span class="line">    "changed": false, </span><br><span class="line">    "stat": &#123;</span><br><span class="line">        "atime": 1484225125.1479475, </span><br><span class="line">        "checksum": "b3afe00a995630184d98194c1a61d6f8fced1f05", </span><br><span class="line">        "ctime": 1484225125.5839477, </span><br><span class="line">        "dev": 2049, </span><br><span class="line">        "executable": false, </span><br><span class="line">        "exists": true, </span><br><span class="line">        "gid": 0, </span><br><span class="line">        "gr_name": "root", </span><br><span class="line">        "inode": 27787277, </span><br><span class="line">        "isblk": false, </span><br><span class="line">        "ischr": false, </span><br><span class="line">        "isdir": false, </span><br><span class="line">        "isfifo": false, </span><br><span class="line">        "isgid": false, </span><br><span class="line">        "islnk": false, </span><br><span class="line">        "isreg": true, </span><br><span class="line">        "issock": false, </span><br><span class="line">        "isuid": false, </span><br><span class="line">        "md5": "1de3012618bc0c1d1e42534d365a8ca5", </span><br><span class="line">        "mode": "0644", </span><br><span class="line">        "mtime": 1484225124.8959477, </span><br><span class="line">        "nlink": 1, </span><br><span class="line">        "path": "/home/kongdefei/tidb/tidb-latest-linux-amd64.tar.gz", </span><br><span class="line">        "pw_name": "root", </span><br><span class="line">        "readable": true, </span><br><span class="line">        "rgrp": true, </span><br><span class="line">        "roth": true, </span><br><span class="line">        "rusr": true, </span><br><span class="line">        "size": 51645042, </span><br><span class="line">        "uid": 0, </span><br><span class="line">        "wgrp": false, </span><br><span class="line">        "woth": false, </span><br><span class="line">        "writeable": true, </span><br><span class="line">        "wusr": true, </span><br><span class="line">        "xgrp": false, </span><br><span class="line">        "xoth": false, </span><br><span class="line">        "xusr": false</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="管理软件模块"><a href="#管理软件模块" class="headerlink" title="管理软件模块"></a>管理软件模块</h4><p>指像yum, apt等管理包的软件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>安装nginx软件包</span><br><span class="line"><span class="meta">$</span>ansible web -m yum -a "name=nginx state=present"</span><br><span class="line"><span class="meta">$</span>ansible web -m apt -a "name=nginx state=present"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>安装包到一个特定的版本</span><br><span class="line"><span class="meta">$</span>ansible web -m yum -a "name=nginx-1.6.2 state=present"</span><br><span class="line"><span class="meta">$</span>ansible web -m apt -a "name=nginx-1.6.2 state=present"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>指定某个源仓库安装某软件包</span><br><span class="line"><span class="meta">$</span>ansible web -m yum -a "name=php55w enablerepo=remi state=present"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>更新一个软件包是最新版本</span><br><span class="line"><span class="meta">$</span>ansible web -m yum -a "name=nginx state=latest"</span><br><span class="line"><span class="meta">$</span>ansible web -m apt -a "name=nginx state=latest"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>卸载一个软件</span><br><span class="line"><span class="meta">$</span>ansible web -m yum -a "name=nginx state=absent"</span><br><span class="line"><span class="meta">$</span>ansible web –m apt -a "name=nginx state=absent"</span><br></pre></td></tr></table></figure><p>Ansible 支持很多操作系统的软件包管理，使用时 -m 指定相应的软件包管理工具模块，如果没有这样的模块，可以自己定义类似的模块或者使用 command 模块来安装软件包</p><h4 id="User模块"><a href="#User模块" class="headerlink" title="User模块"></a>User模块</h4><p>用户模块主要用于创建，更改，删除用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>创建一个用户</span><br><span class="line"><span class="meta">$</span>ansible all -m user -a "name=hadoop password=123456"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>删除用户</span><br><span class="line">ansible all -m user -a "name=hadoop state=absent"</span><br></pre></td></tr></table></figure><h4 id="service模块"><a href="#service模块" class="headerlink" title="service模块"></a>service模块</h4><p>主要是控制被控机的各种service。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>启动,重启，停止httpd服务</span><br><span class="line"><span class="meta">$</span>ansible all -m service -a "name=httpd state=started(restarted|stopped)"</span><br></pre></td></tr></table></figure><div style="display:none"><script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script></div><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>